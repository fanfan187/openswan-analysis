######################################################################### # Openswan 2.X 发行说明 ######################################################################### Openswan 是一个适用于 Linux 的 IPsec 实现。它支持大多数与 IPsec 相关的扩展（RFC 和 IETF 草案），包括 IKEv2、X.509 数字证书、NAT 穿越以及许多其他扩展。 Openswan 最初基于 FreeS/WAN 2.04 CVS，加上 Andreas Steffen 的 X.509 补丁、Arkoon Networks 的 NAT-T 补丁以及 2.05 和 2.06 中的一些小 bug 修复。更多历史详情请参见 CREDITS 文件。 从以下地址下载： https://download.openswan.org/openswan/ ######################################################################### # 系统要求 ######################################################################### 目前支持的平台为基于 Kernel 2.4.x 或 2.6.x 的较新 Linux 发行版。 大多数最新的发行版均提供 openswan 的软件包支持。除非确实需要基于源码的编译，否则通常最好使用预编译的发行版软件包版本。 编译 Openswan 源码需要以下几个软件包： 1. GNU 高精度数学库（GNU Math Precision Library）： Debian 软件包名称：libgmp-dev RPM 软件包名称： gmp, gmp-devel 对于 RPM 用户来说，如果系统中尚未安装 gcc，可能需要安装 gcc。 2. make、flex 和 bison： Debian 软件包名称：make, flex, bison RPM 软件包名称： 与 Debian 相同 3. 运行时所需工具：iproute2、iptables、sed、awk、bash、cut 以及其他可能需要的工具。 Debian 软件包名称：iproute2, iptables，其余工具通常已预装 RPM 软件包名称： 与 Debian 相同 另外，运行 “ipsec verify” 时还需要 python。 4. 运行单元测试： Debian 软件包名称：libpcap0.8-dev, libpcap0.8, electric-fence, tcpdump RPM 软件包名称： libpcap, libpcap-devel, ElectricFence, tcpdump 5. 使用 LIBNSS 构建： Debian 软件包名称：libnspr4-dev, libnss3-dev, libnss3-tools RPM 软件包名称： 与 Debian 相同 ######################################################################### # 在 Kernel 2.6（以及带有 2.6 IPsec 移植版内核）的安装方法 ######################################################################### NETKEY（Linux 原生 IPsec 堆栈） --------------------------------- 若要使用带有 Linux 原生（内置）IPsec 堆栈的 Openswan，仅需执行以下步骤。请至少使用 2.6.9 版本的内核，因为早期版本的内核其原生 IPsec 堆栈存在严重 bug。操作步骤如下（在 Openswan 源代码目录下执行）： make programs sudo make install 注意：不再需要 ipsec-tools 软件包。取而代之的是需要 iproute2 版本不低于 2.6.8。对于移植版内核，可能仍需要 setkey 以及 ipsec-tools。可运行 “ipsec verify” 来检查系统是否满足其中任一要求。 KLIPS/KLIPSNG（Openswan IPsec 堆栈） ------------------------------------ 要在 Linux 内核 2.6.23 及以上版本上使用 Openswan 的 KLIPS IPsec 堆栈（ipsec0 设备），请执行以下步骤（在 Openswan 源代码目录下执行）： make programs make KERNELSRC=/lib/modules/uname -r/build module sudo make KERNELSRC=/lib/modules/uname -r/build install minstall 对于 2.6 内核版本低于 2.6.23 的系统，包括 2.4 Linux 系统，如果需要 NAT-T 支持或 SAref 追踪功能，则需要对内核进行打补丁。此时需要完整的内核源代码，因为内核源代码需要被打补丁、编译和安装。建议先构建并安装一个未打补丁的内核，以确保过程正确。详情请参阅你所使用发行版的内核构建和安装文档。 确定 Linux 源代码目录，例如大多数完整源码安装情况下在 /usr/src/linux 下，也可能是 /usr/src/linux-2.[46].X 添加 NAT-T 支持（如果需要）。 在 Openswan 源代码目录下执行： make KERNELSRC=/usr/src/linux nattpatch | patch -d /usr/src/linux -p1 添加 SAref 追踪支持（如果需要）。 针对某些发行版内核的预制补丁可在 patches/kernel/ 目录中找到。建议使用 2.6.32 或更高版本的内核。有关 SAref/MAST 的文档可在 docs/HACKING/Mast* 和 doc/klips/mast.xml 中查阅。要理解 SAref 追踪的作用，请参阅 doc/ipsecsaref.png 以及 ipsec.conf 手册页中关于 overlapip= 选项的说明。 在 Openswan 源代码目录下执行： make KERNELSRC=/usr/src/linux sarefpatch | patch -d /usr/src/linux -p1 添加 OCF 硬件卸载支持 若需添加 OCF 硬件卸载支持，你还需要一个已打补丁的内核。更多详情请参见：http://ocf-linux.sourceforge.net/ 构建并安装新内核 请参照你所使用发行版的文档，了解如何安装新内核。步骤大致如下： cd /usr/src/linux make oldconfig make dep - （该步骤在 2.6 系统上可忽略） make bzImage install 构建 Openswan 在 Openswan 源代码目录下执行： make programs make KERNELSRC=/usr/src/linux module sudo make KERNELSRC=/usr/src/linux install minstall Openswan 的配置文件可以通过在 ipsec.conf 中使用 "protostack=<klips|netkey|mast>" 选项来选择运行时使用哪种 IPsec 堆栈。有关配置选项的详细信息，请参阅 ipsec.conf 手册页。 ######################################################################### # 升级 ######################################################################### 1. 如果你将产品从 1.x 升级到 Openswan 2.x，则需要调整你的配置文件。关于更改内容的详细信息，请参阅 doc/upgrading.html。 2. 你可以直接执行 'make install' 覆盖安装旧版本 —— 这不会替换 /etc/ipsec.* 中的配置文件。 ######################################################################### # 支持 ######################################################################### 邮件列表： https://lists.openswan.org 是邮件列表的主页。注意：这些列表为封闭列表——你必须订阅后才能发送邮件。 Wiki： https://github.com/xelerance/Openswan/wiki 是 Openswan Wiki 的主页。这里提供了最新的文档、互通指南以及其他相关信息。 IRC： Openswan 的开发者和用户可以通过 IRC 在 irc.freenode.net 上的 #openswan 频道中找到。 此外，Openswan 也提供商业支持 —— 详情请访问 https://www.xelerance.com/incidents 或发送邮件至 sales@xelerance.com。 ######################################################################### # BUGS ######################################################################### 有关该软件包的 bug 报告请提交至： https://github.com/xelerance/Openswan/issues 如发现安全漏洞，请发送邮件至：security@xelerance.com ######################################################################### # 安全漏洞 ######################################################################### 所有需要公开披露的安全漏洞都会获得正式的 CVE 跟踪编号（参见 http://mitre.org/）并通过 vendor-sec 邮件列表协调。已知安全漏洞的完整列表可在以下网址查看： https://github.com/xelerance/Openswan/wiki/Security-and-vulnerability-information ######################################################################### # 开发 ######################################################################### 对 Openswan 的开发、补丁以及 beta 版本感兴趣者可以加入开发邮件列表（https://lists.openswan.org - dev@lists.openswan.org），也可通过 IRC 加入开发团队（在 irc.freenode.net 上的 #openswan-dev 频道）。 ######################################################################### # 文档 ######################################################################### 最新文档请参阅：https://github.com/xelerance/Openswan/wiki 在 doc 目录下有若干高级文档，其中大部分为 HTML 格式；参见 doc/index.html 获取顶级索引。这些文档现已视为过时。 从源码构建时，至少需要 60MB 的可用空间（当前源码树约 40MB）。 该软件主要遵循 GNU 通用公共许可证（GPL）；具体部分请参阅 LICENSE 文件。部分代码不适用 GPL 许可证，详情请参见 CREDITS 文件。